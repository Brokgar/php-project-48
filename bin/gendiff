#!/usr/bin/env php
<?php

// Подключаем автозагрузку Composer
require_once dirname(__DIR__) . '/vendor/autoload.php';

use Hexlet\Code\Parser;

function showHelp() {
    $helpText = <<<HELP
Использование: gendiff [ОПЦИИ] <файл1> <файл2>

Сравнивает два конфигурационных файла JSON и показывает различия.

ОПЦИИ:
  -h, --help             Показать эту справку
  -f, --format <тип>    Формат вывода (plain, stylish, json)
  --color                Цветной вывод (если поддерживается)

ПРИМЕРЫ:
  gendiff file1.json file2.json
  gendiff ./data/file1.json /absolute/path/file2.json
  gendiff -f plain ../relative/path/config1.json config2.json


ДОСТУПНЫЕ ФОРМАТЫ:
  plain   - Простой текстовый формат, только изменения
  stylish - Красивый формат с отступами и иконками
  json    - JSON‑представление различий


ПОДДЕРЖИВАЕМЫЕ ФОРМАТЫ ФАЙЛОВ:
  JSON

Для получения подробной информации посетите:
https://example.com/gendiff-docs
HELP;

    echo $helpText . "\n";
}


function main($argv) {
    if (in_array('-h', $argv) || in_array('--help', $argv)) {
        showHelp();
        exit(0);
    }

    $args = array_slice($argv, 1);
    $options = [];
    $files = [];

    for ($i = 0; $i < count($args); $i++) {
        $arg = $args[$i];

        if ($arg === '-f' || $arg === '--format') {
            if ($i + 1 < count($args)) {
                $options['format'] = $args[$i + 1];
                $i++;
            } else {
                echo "Ошибка: опция -f/--format требует указания формата\n";
                exit(1);
            }
        } elseif ($arg === '--color') {
            $options['color'] = true;
        } else {
            $files[] = $arg;
        }
    }

    if (count($files) !== 2) {
        echo "Ошибка: необходимо указать ровно два файла для сравнения\n";
        echo "Использование: gendiff [ОПЦИИ] <файл1> <файл2>\n";
        exit(1);
    }

    try {
        // Используем модуль парсинга для загрузки данных — содержимое печатается автоматически
        $data1 = Parser::parseFile($files[0]);
        $data2 = Parser::parseFile($files[1]);

        $format = $options['format'] ?? 'plain';
        $allowedFormats = ['plain', 'stylish', 'json'];

        if (!in_array($format, $allowedFormats)) {
            echo "Ошибка: недопустимый формат вывода '$format'. Допустимые: " . implode(', ', $allowedFormats) . "\n";
            exit(1);
        }

        echo "Файлы успешно загружены и отображены:\n";
        echo "Файл 1: {$files[0]} (".count($data1)." элементов)\n";
        echo "Файл 2: {$files[1]} (".count($data2)." элементов)\n";
        echo "Формат вывода: $format\n";

        if (isset($options['color'])) {
            echo "Цветной вывод: включен\n";
        }

        // Здесь будет логика сравнения данных
        echo "\nСравнение завершено (демо-режим)\n";
    } catch (Exception $e) {
        echo "Ошибка: " . $e->getMessage() . "\n";
        exit(1);
    }
}

main($argv);
?>
